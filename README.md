<span class="c1">Вы можете не выполнять задание, если у вас есть репозиторий (один или несколько), который продемонстрирует ваш опыт и знания в данной области. Отправьте его ссылку нам на почту iactive.pro.job@gmail.com с вашим резюме. Однако, мы можем все равно попросить частично или полностью выполнить задание, если потребуется.</span>

<span class="c1"></span>

<span class="c1">Дата до которого может быть выслано решение: **25.07.20**.</span>
<span class="c1">*Дата может измениться, но только в большую сторону.*</span>

<span class="c1">По окончанию работы мы ожидаем получить ссылку на репозиторий с кодом и дампом базы данных. В сообщении также должна идти ссылка на ваше резюме.</span>

<span class="c1"></span>

<span class="c1">Email для отправки решений: iactive.pro.job@gmail.com</span>

<span class="c1">Email для вопросов: iactive.job.ask@gmail.com</span>

<span class="c1"></span>

<span class="c1"></span>

<span class="c1">Если вы не успели реализовать все, ничего страшного, все равно отправьте свое решение.</span>

<span class="c1">По окончанию проверки мы вышлем приглашение на интервью. Спасибо.</span>

<span class="c1"></span>

<h2 class="c6">Задача на должность “PHP разработчик удаленно”</h2>

<span class="c1">Спроектировать базу данных. Написать api для приема вебхука c сообщениями, реализовать функционал вывода сообщений json.</span>

<span class="c1"></span>

База
--------------------------------------------------------------------------------

**Требования**

<span class="c1">Mysql 5.3+</span>

<span class="c1"></span>

**Создать таблицы:**

```
authors
--------------
id
phone
datetime_first_message
datetime_last_message
messages_count
is_banned
--------------------------------------------------------
messages
--------------
id
author_id
datetime
content
is_deleted
--------------------------------------------------------

```


<span class="c1">База должна быть спроектирована и создана с учетом высоких нагрузок. Допускается изменение структуры и названия полей базы по вашему усмотрению.</span>

<span class="c1"></span>

PHP
--------------------------------------------------------------------------------

<span class="c3">Требования:</span>

<span class="c1">PHP 7+, просьба не использовать готовые решения и мэйкеры.</span>

<span class="c3"></span>

<h3>Webhook</h3>

<span class="c3">Сервер, принимающий webhook должен быть доступен:</span>

```
URL: /api/webhook
Method: POST
Content-Type: application/json
```

<span class="c3"></span>

<span class="c7">Запрос webhook</span><span class="c1"> </span>

```
{
    "messages":[
      {
          "message":"Как ваши дела?",
         "phone":"7999999999"
      },
      {
          "message":"Привет!",
         "phone":"7999999998"
      }
   ]
}

```

<span class="c1"></span>

<span class="c3">Ответ:</span>

```
{
    "status": "ok",
    "body": "added 2",
    "code": 200
}

```

<span class="c1"></span>

<span class="c1">И ошибка, если хотя бы одно из сообщений не добавлено</span>

```
{
    "status": "error",
    "body": "not all added",
    "code": 500
}

```

<span class="c1"></span>

<span class="c1">В случае, если сервер вернул ошибку, хук через 1 минуту повторит тот же запрос. Необходимо учесть это и не допустить дубликаты сообщений.</span>

<span class="c4"></span>

> Подсказка: в базе может быть очень много сообщений, с разным содержанием, поэтому проверять по полю content может быть очень времязатратно, но при этом мы можем позволить отсечь несколько одинаковых сообщений автора, отправленных в течении 2-х минут

<span class="c1"></span>

<span class="c1">Если автора нет в базе - записать его. Обновить поля datetime_last_message и messages_count</span>

<span class="c4"></span>

<h3>Получение списка сообщений с данными о авторе</h3>

<span class="c1">Необходимо вернуть массив с не удаленными сообщениями и сообщениями, автор которых не заблокирован + данными о авторе.</span>

<span class="c1"></span>
```
URL: /api/messages
Method: GET
Content-Type: application/json
```

<span class="c3"></span>

<h4 class="c3">Ответ:</h4>

<span class="c1">В ответе должен прийти массив сообщений.</span>

<span class="c1"></span>
<span class="c1">Поля для объекта сообщения:</span>
```
message_id
author_id
datetime
content
datetime_first_message
datetime_last_message
messages_count

```



Дополнительно
==============
Это не обязательные пункты, но вы можете их выполнить. Если вы выполните хотя бы один из них, укажите это в теме письма 

* Реализовать постраничный вывод сообщений. Ограничение сообщений на странице - 20 штук;
* Написать Unit тесты и подготовить данные для наполнения базы (случайные сообщения с авторами);
* Реализовать разделение сообщения на несколько, если его размер превышает 10 000 символов.
